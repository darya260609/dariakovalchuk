// Translations object (inline to avoid module issues)
const translations = {
    en: {
        nav: {
            home: "Home",
            about: "About Us",
            services: "Services",
            servicesItems: {
                brand: "Brand Design",
                marketing: "Digital Marketing",
                web: "Web Development",
                consulting: "Consulting",
                automation: "Automation"
            },
            courses: "Courses",
            coursesItems: {
                course1: "Course 1"
            },
            portfolio: "Portfolio",
            contact: "Contact",
            language: "Language"
        },
        hero: {
            line1: "Target Vision",
            line2: "Digital Excellence",
            subtitle: "Premium digital solutions for ambitious brands",
            cta1: "Get Started",
            cta2: "Explore Services"
        },
        about: {
            title: "About Us",
            subtitle: "Company Director",
            description1: "Target Vision is a leading digital agency specializing in creating luxurious digital experiences that captivate and convert. Our approaches combine strategic thinking with aesthetic excellence.",
            description2: "We believe in the power of minimalism, elegance, and purposeful design to tell compelling brand stories that resonate with sophisticated audiences.",
            member2: {
                name: "Name Surname",
                subtitle: "Position",
                description: "Second team member description will be added later."
            }
        },
        services: {
            title: "Services",
            subtitle: "Tailored solutions for premium brands",
            brand: {
                title: "Brand Design",
                description: "Creating distinctive visual identities that embody luxury and sophistication"
            },
            marketing: {
                title: "Digital Marketing",
                description: "Strategic campaigns that elevate your brand presence and foster meaningful engagement"
            },
            web: {
                title: "Web Development",
                description: "Custom websites that combine cutting-edge technology with timeless design"
            },
            consulting: {
                title: "Consulting",
                description: "Expert guidance for optimizing your digital approach and strategy"
            },
            automation: {
                title: "Automation",
                description: "Intelligent process automation for increased efficiency and time savings"
            }
        },
        courses: {
            title: "Courses",
            subtitle: "Professional education for your success",
            course1: {
                title: "Course 1",
                subtitle: "Learn the basics of digital marketing",
                description: "Complete course for beginners who want to enter the world of digital marketing. You will learn the basics, strategies and practical skills needed for success in the digital world."
            }
        },
        portfolio: {
            title: "Portfolio",
            subtitle: "Showcase of our best projects"
        },
        contact: {
            title: "Get In Touch",
            subtitle: "Let's create something extraordinary together",
            form: {
                name: "Your Name",
                email: "Your Email",
                subject: "Subject",
                message: "Your Message",
                submit: "Send Message"
            }
        },
        footer: {
            rights: "© 2024 Target Vision. All rights reserved.",
            tagline: "Crafted with excellence"
        }
    },
    cs: {
        nav: {
            home: "Domů",
            about: "O nás",
            services: "Služby",
            servicesItems: {
                brand: "Design Značky",
                marketing: "Digitální Marketing",
                web: "Webový Vývoj",
                consulting: "Konzultace",
                automation: "Automatizace"
            },
            courses: "Kurzy",
            coursesItems: {
                course1: "Kurz 1"
            },
            portfolio: "Výsledky práce",
            contact: "Kontakt",
            language: "Jazyk"
        },
        hero: {
            line1: "Target Vision",
            line2: "Digitální Excelence",
            subtitle: "Prémiová digitální řešení pro ambiciózní značky",
            cta1: "Začít",
            cta2: "Prozkoumat služby"
        },
        about: {
            title: "O nás",
            subtitle: "Ředitelka společnosti",
            description1: "Target Vision je přední digitální agentura specializující se na vytváření luxusních digitálních zážitků, které fascinují a konvertují. Naše přístupy kombinují strategické myšlení s estetickou dokonalostí.",
            description2: "Věříme v sílu minimalismu, elegance a účelového designu pro vyprávění přesvědčivých příběhů značek, které rezonují se sofistikovaným publikem.",
            member2: {
                name: "Jméno Příjmení",
                subtitle: "Pozice",
                description: "Popis druhého člena týmu bude doplněn později."
            }
        },
        services: {
            title: "Služby",
            subtitle: "Řešení na míru pro prémiové značky",
            brand: {
                title: "Design Značky",
                subtitle: "Vytváříme výrazné vizuální identity",
                description: "Vytváření výrazných vizuálních identit, které ztělesňují luxus a sofistikovanost. Naše práce kombinuje kreativní vizi s strategickým přístupem k vytvoření značky, která rezonuje s vaším cílovým publikem."
            },
            marketing: {
                title: "Digitální Marketing",
                subtitle: "Strategické kampaně pro váš úspěch",
                description: "Strategické kampaně, které pozvedají přítomnost vaší značky a podporují smysluplnou interakci. Naše digitální marketingové strategie jsou navrženy tak, aby maximalizovaly ROI a budovaly dlouhodobé vztahy s vaším publikem."
            },
            web: {
                title: "Webový Vývoj",
                subtitle: "Moderní webové řešení",
                description: "Webové stránky na míru, které kombinují špičkovou technologii s nadčasovým designem. Vytváříme responsivní a rychlé weby, které poskytují vynikající uživatelskou zkušenost."
            },
            consulting: {
                title: "Konzultace",
                subtitle: "Odborné poradenství",
                description: "Odborné poradenství pro optimalizaci vašeho digitálního přístupu a strategie. Pomáháme vám najít nejlepší řešení pro váš business a implementovat efektivní strategie."
            },
            automation: {
                title: "Automatizace",
                subtitle: "Inteligentní řešení pro váš úspěch",
                description: "Inteligentní automatizace procesů pro zvýšení efektivity a úsporu času. Naše řešení kombinují nejmodernější technologie s praktickým přístupem k optimalizaci vašich obchodních procesů."
            }
        },
        courses: {
            title: "Kurzy",
            subtitle: "Profesionální vzdělávání pro váš úspěch",
            course1: {
                title: "Kurz 1",
                subtitle: "Naučte se základy digitálního marketingu",
                description: "Kompletní kurz pro začátečníky, kteří chtějí proniknout do světa digitálního marketingu. Naučíte se základy, strategie a praktické dovednosti potřebné pro úspěch v digitálním světě."
            }
        },
        portfolio: {
            title: "Výsledky práce",
            subtitle: "Ukázky našich nejlepších projektů"
        },
        contact: {
            title: "Kontakt",
            subtitle: "Vytvořme něco mimořádného společně",
            form: {
                name: "Vaše jméno",
                email: "Váš email",
                subject: "Předmět",
                message: "Vaše zpráva",
                submit: "Odeslat zprávu"
            }
        },
        footer: {
            rights: "© 2024 Target Vision. Všechna práva vyhrazena.",
            tagline: "Vytvořeno s excelencí"
        }
    },
    ru: {
        nav: {
            home: "Главная",
            about: "О нас",
            services: "Услуги",
            servicesItems: {
                brand: "Дизайн бренда",
                marketing: "Цифровой маркетинг",
                web: "Веб-разработка",
                consulting: "Консультации",
                automation: "Автоматизация"
            },
            courses: "Курсы",
            coursesItems: {
                course1: "Курс 1"
            },
            portfolio: "Портфолио",
            contact: "Контакты",
            language: "Язык"
        },
        hero: {
            line1: "Поднимите свое",
            line2: "Цифровое присутствие",
            subtitle: "Премиальные решения для амбициозных брендов",
            cta1: "Начать",
            cta2: "Изучить услуги"
        },
        about: {
            title: "О нас",
            subtitle: "Цифровой стратег и креативный директор",
            description1: "С более чем десятилетним опытом в цифровом маркетинге и развитии брендов я специализируюсь на создании роскошных цифровых впечатлений, которые очаровывают и конвертируют. Мой подход сочетает стратегическое мышление с эстетическим совершенством.",
            description2: "Я верю в силу минимализма, элегантности и целенаправленного дизайна для создания убедительных историй брендов, которые находят отклик у искушенной аудитории.",
            member2: {
                name: "Имя Фамилия",
                subtitle: "Должность",
                description: "Описание второго члена команды будет добавлено позже."
            }
        },
        services: {
            title: "Услуги",
            subtitle: "Индивидуальные решения для премиальных брендов",
            brand: {
                title: "Дизайн бренда",
                description: "Создание выразительных визуальных идентичностей, воплощающих роскошь и изысканность"
            },
            marketing: {
                title: "Цифровой маркетинг",
                description: "Стратегические кампании, которые поднимают присутствие вашего бренда и способствуют осмысленному взаимодействию"
            },
            web: {
                title: "Веб-разработка",
                description: "Индивидуальные веб-сайты, сочетающие передовые технологии с вневременным дизайном"
            },
            consulting: {
                title: "Консультации",
                description: "Экспертное руководство для оптимизации вашего цифрового подхода и стратегии"
            },
            automation: {
                title: "Автоматизация",
                description: "Интеллектуальная автоматизация процессов для повышения эффективности и экономии времени"
            }
        },
        courses: {
            title: "Курсы",
            subtitle: "Профессиональное образование для вашего успеха",
            course1: {
                title: "Курс 1",
                subtitle: "Изучите основы цифрового маркетинга",
                description: "Полный курс для начинающих, которые хотят войти в мир цифрового маркетинга. Вы изучите основы, стратегии и практические навыки, необходимые для успеха в цифровом мире."
            }
        },
        portfolio: {
            title: "Портфолио",
            subtitle: "Демонстрация наших лучших проектов"
        },
        contact: {
            title: "Связаться",
            subtitle: "Давайте создадим что-то необыкновенное вместе",
            form: {
                name: "Ваше имя",
                email: "Ваш email",
                subject: "Тема",
                message: "Ваше сообщение",
                submit: "Отправить сообщение"
            }
        },
        footer: {
            rights: "© 2024 Daria Kovalchuk. Все права защищены.",
            tagline: "Создано с совершенством"
        }
    },
    uk: {
        nav: {
            home: "Головна",
            about: "Про нас",
            services: "Послуги",
            servicesItems: {
                brand: "Дизайн бренду",
                marketing: "Цифровий маркетинг",
                web: "Веб-розробка",
                consulting: "Консультації",
                automation: "Автоматизація"
            },
            courses: "Курси",
            coursesItems: {
                course1: "Курс 1"
            },
            portfolio: "Портфоліо",
            contact: "Контакти",
            language: "Мова"
        },
        hero: {
            line1: "Підніміть свою",
            line2: "Цифрову присутність",
            subtitle: "Преміальні рішення для амбітних брендів",
            cta1: "Почати",
            cta2: "Вивчити послуги"
        },
        about: {
            title: "Про нас",
            subtitle: "Цифровий стратег і креативний директор",
            description1: "З більш ніж десятирічним досвідом у цифровому маркетингу та розвитку брендів я спеціалізуюся на створенні розкішних цифрових вражень, які зачаровують та конвертують. Мій підхід поєднує стратегічне мислення з естетичною досконалістю.",
            description2: "Я вірю в силу мінімалізму, елегантності та цілеспрямованого дизайну для створення переконливих історій брендів, які знаходять відгук у витонченої аудиторії.",
            member2: {
                name: "Ім'я Прізвище",
                subtitle: "Посада",
                description: "Опис другого члена команди буде додано пізніше."
            }
        },
        services: {
            title: "Послуги",
            subtitle: "Індивідуальні рішення для преміальних брендів",
            brand: {
                title: "Дизайн бренду",
                description: "Створення виразних візуальних ідентичностей, що втілюють розкіш і витонченість"
            },
            marketing: {
                title: "Цифровий маркетинг",
                description: "Стратегічні кампанії, які піднімають присутність вашого бренду та сприяють змістовній взаємодії"
            },
            web: {
                title: "Веб-розробка",
                description: "Індивідуальні веб-сайти, що поєднують передові технології з позачасовим дизайном"
            },
            consulting: {
                title: "Консультації",
                description: "Експертне керівництво для оптимізації вашого цифрового підходу та стратегії"
            },
            automation: {
                title: "Автоматизація",
                description: "Інтелектуальна автоматизація процесів для підвищення ефективності та економії часу"
            }
        },
        courses: {
            title: "Курси",
            subtitle: "Професійна освіта для вашого успіху",
            course1: {
                title: "Курс 1",
                subtitle: "Вивчіть основи цифрового маркетингу",
                description: "Повний курс для початківців, які хочуть увійти в світ цифрового маркетингу. Ви вивчите основи, стратегії та практичні навички, необхідні для успіху в цифровому світі."
            }
        },
        portfolio: {
            title: "Портфоліо",
            subtitle: "Демонстрація наших найкращих проектів"
        },
        contact: {
            title: "Зв'язатися",
            subtitle: "Давайте створимо щось надзвичайне разом",
            form: {
                name: "Ваше ім'я",
                email: "Ваш email",
                subject: "Тема",
                message: "Ваше повідомлення",
                submit: "Надіслати повідомлення"
            }
        },
        footer: {
            rights: "© 2024 Daria Kovalchuk. Всі права захищені.",
            tagline: "Створено з досконалістю"
        }
    }
};

// Initialize AOS (Animate On Scroll) with mobile optimization
AOS.init({
    duration: 1000,
    once: true,
    offset: 100,
    // Disable animations on mobile for better performance
    disable: 'mobile'
});

// Navbar scroll effect
const navbar = document.getElementById('navbar');
const scrollThreshold = 100;

window.addEventListener('scroll', () => {
    if (window.scrollY > scrollThreshold) {
        navbar.classList.add('scrolled');
    } else {
        navbar.classList.remove('scrolled');
    }
});

// Mobile menu toggle
const hamburger = document.getElementById('hamburger');
const navMenu = document.getElementById('navMenu');
const navLinks = document.querySelectorAll('.nav-link');

hamburger.addEventListener('click', () => {
    hamburger.classList.toggle('active');
    navMenu.classList.toggle('active');
});

// Close mobile menu when clicking on a link
navLinks.forEach(link => {
    link.addEventListener('click', () => {
        hamburger.classList.remove('active');
        navMenu.classList.remove('active');
        
        // Add touch feedback for mobile
        if ('ontouchstart' in window) {
            link.style.transform = 'scale(0.95)';
            setTimeout(() => {
                link.style.transform = '';
            }, 150);
        }
    });
});

// Language dropdown functionality (only for language switcher)
const langToggles = document.querySelectorAll('.lang-toggle');
const langOptions = document.querySelectorAll('.lang-option');

// Close language dropdown when clicking outside
document.addEventListener('click', (e) => {
    if (!e.target.closest('.language-dropdown')) {
        document.querySelectorAll('.language-dropdown').forEach(dropdown => {
            dropdown.classList.remove('active');
        });
    }
});

// Toggle language dropdown on click and touch
langToggles.forEach(toggle => {
    const handleToggle = (e) => {
        e.preventDefault();
        e.stopPropagation(); // Prevent event bubbling
        const dropdown = toggle.closest('.language-dropdown');
        
        // Close other dropdowns
        document.querySelectorAll('.language-dropdown').forEach(otherDropdown => {
            if (otherDropdown !== dropdown) {
                otherDropdown.classList.remove('active');
            }
        });
        
        // Toggle current dropdown
        dropdown.classList.toggle('active');
    };
    
    toggle.addEventListener('click', handleToggle);
    toggle.addEventListener('touchstart', handleToggle, { passive: false });
});

// Handle language option clicks and touch
langOptions.forEach(option => {
    const handleOption = (e) => {
        e.preventDefault();
        e.stopPropagation(); // Prevent event bubbling
        const lang = option.getAttribute('data-lang');
        if (lang) {
            setLanguage(lang);
        }
        
        // Close all language dropdowns
        document.querySelectorAll('.language-dropdown').forEach(dropdown => {
            dropdown.classList.remove('active');
        });
    };
    
    option.addEventListener('click', handleOption);
    option.addEventListener('touchstart', handleOption, { passive: false });
});

// Smooth scrolling for anchor links with mobile optimization
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            const offsetTop = target.offsetTop - navbar.offsetHeight;
            
            // Use different scroll behavior for mobile
            if ('ontouchstart' in window) {
                // For mobile devices, use instant scroll for better performance
                window.scrollTo({
                    top: offsetTop,
                    behavior: 'auto'
                });
            } else {
                // For desktop, use smooth scroll
                window.scrollTo({
                    top: offsetTop,
                    behavior: 'smooth'
                });
            }
        }
    });
});

// Active navigation link highlighting with mobile optimization
const sections = document.querySelectorAll('section[id]');

// Throttle scroll events for better mobile performance
let ticking = false;
function updateActiveNav() {
    let current = '';
    sections.forEach(section => {
        const sectionTop = section.offsetTop - navbar.offsetHeight - 100;
        const sectionHeight = section.clientHeight;
        if (window.scrollY >= sectionTop && window.scrollY < sectionTop + sectionHeight) {
            current = section.getAttribute('id');
        }
    });

    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === `#${current}`) {
            link.classList.add('active');
        }
    });
    
    ticking = false;
}

window.addEventListener('scroll', () => {
    if (!ticking) {
        requestAnimationFrame(updateActiveNav);
        ticking = true;
    }
});

// Add touch feedback for service and course cards
document.querySelectorAll('.service-card, .course-card').forEach(card => {
    if ('ontouchstart' in window) {
        card.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.98)';
        });
        
        card.addEventListener('touchend', function() {
            this.style.transform = '';
        });
    }
});

// Lightbox functionality for portfolio
const portfolioItems = document.querySelectorAll('.portfolio-item');
const lightbox = document.createElement('div');
lightbox.className = 'lightbox';
lightbox.innerHTML = `
    <div class="lightbox-content">
        <img class="lightbox-image" src="" alt="">
        <div class="lightbox-caption">
            <h4></h4>
            <p></p>
        </div>
        <button class="lightbox-close">&times;</button>
    </div>
`;
document.body.appendChild(lightbox);

portfolioItems.forEach(item => {
    item.addEventListener('click', () => {
        const img = item.querySelector('img');
        const title = item.querySelector('h4');
        const description = item.querySelector('p');
        
        lightbox.querySelector('.lightbox-image').src = img.src;
        lightbox.querySelector('.lightbox-image').alt = img.alt;
        lightbox.querySelector('.lightbox-caption h4').textContent = title.textContent;
        lightbox.querySelector('.lightbox-caption p').textContent = description.textContent;
        
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
    });
});

// Close lightbox
lightbox.addEventListener('click', (e) => {
    if (e.target === lightbox || e.target.classList.contains('lightbox-close')) {
        lightbox.classList.remove('active');
        document.body.style.overflow = '';
    }
});

// Escape key to close lightbox
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && lightbox.classList.contains('active')) {
        lightbox.classList.remove('active');
        document.body.style.overflow = '';
    }
});

// Counter animation for stats
const stats = document.querySelectorAll('.stat-number');
const animateCounter = (element, target) => {
    let current = 0;
    const increment = target / 50;
    const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
            element.textContent = element.dataset.suffix ? target + element.dataset.suffix : target + '+';
            clearInterval(timer);
        } else {
            element.textContent = Math.floor(current) + (element.dataset.suffix || '+');
        }
    }, 30);
};

// Intersection Observer for counter animation
const observerOptions = {
    threshold: 0.5,
    rootMargin: '0px'
};

const counterObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting && !entry.target.classList.contains('animated')) {
            const target = parseInt(entry.target.textContent);
            animateCounter(entry.target, target);
            entry.target.classList.add('animated');
        }
    });
}, observerOptions);

stats.forEach(stat => {
    counterObserver.observe(stat);
});

// Add loading animation
window.addEventListener('load', () => {
    document.body.classList.add('loaded');
});

// Language switching functionality
function setLanguage(lang) {
    console.log('Setting language to:', lang);
    // Update active button (legacy)
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        }
    });

    // Update active language option (new dropdown)
    document.querySelectorAll('.lang-option').forEach(option => {
        option.classList.remove('active');
        if (option.getAttribute('data-lang') === lang) {
            option.classList.add('active');
        }
    });

    // Update language toggle display
    const langToggle = document.querySelector('.lang-toggle');
    if (langToggle) {
        const flagIcon = langToggle.querySelector('.flag-icon');
        const langText = langToggle.querySelector('.lang-text');
        
        const flags = {
            'en': '🇺🇸',
            'cs': '🇨🇿',
            'ru': '🇷🇺',
            'uk': '🇺🇦'
        };
        
        const texts = {
            'en': 'EN',
            'cs': 'CS',
            'ru': 'RU',
            'uk': 'UK'
        };
        
        if (flagIcon) flagIcon.textContent = flags[lang] || '🇺🇸';
        if (langText) langText.textContent = texts[lang] || 'EN';
        
        // Update active state of toggle button
        langToggle.classList.remove('active');
        langToggle.classList.add('active');
    }

    // Update all translatable elements
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const keys = key.split('.');
        let value = translations[lang];
        for (const k of keys) {
            if (value && value[k]) {
                value = value[k];
            } else {
                console.warn('Translation not found for key:', key, 'in language:', lang);
                value = key; // Fallback to key if translation not found
                break;
            }
        }
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.placeholder = value;
        } else {
            element.textContent = value;
        }
    });

    // Update all placeholder translations
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        const keys = key.split('.');
        let value = translations[lang];
        for (const k of keys) {
            if (value && value[k]) {
                value = value[k];
            } else {
                console.warn('Placeholder translation not found for key:', key, 'in language:', lang);
                value = key; // Fallback to key if translation not found
                break;
            }
        }
        element.placeholder = value;
    });

    // Save language preference
    try {
        localStorage.setItem('preferredLanguage', lang);
    } catch (e) {
        console.warn('Could not save language preference to localStorage');
    }
}

// Initialize language and event handlers
function initializeLanguageSystem() {
    console.log('Initializing language system...');
    
    // Get saved language
    let savedLang;
    try {
        savedLang = localStorage.getItem('preferredLanguage') || 'en';
    } catch (e) {
        savedLang = 'en'; // Fallback if localStorage is not available
    }

    console.log('Saved language:', savedLang);

    // Set initial language
    setLanguage(savedLang);

    // Add click handlers for language buttons (legacy)
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            setLanguage(lang);
        });
    });

    // Add click handlers for language options (new dropdown)
    const langOptions = document.querySelectorAll('.lang-option');
    console.log('Found language options:', langOptions.length);
    
    langOptions.forEach(option => {
        option.addEventListener('click', () => {
            const lang = option.getAttribute('data-lang');
            console.log('Language option clicked:', lang);
            setLanguage(lang);
            
            // Close language dropdown
            const dropdown = option.closest('.language-dropdown');
            if (dropdown) {
                dropdown.classList.remove('active');
            }
        });
    });

    // Add click handler for language toggle
    const langToggle = document.querySelector('.lang-toggle');
    console.log('Found language toggle:', !!langToggle);
    
    if (langToggle) {
        langToggle.addEventListener('click', (e) => {
            e.preventDefault();
            console.log('Language toggle clicked');
            const dropdown = langToggle.closest('.language-dropdown');
            if (dropdown) {
                dropdown.classList.toggle('active');
                console.log('Dropdown active:', dropdown.classList.contains('active'));
            }
        });
    }
}

// Initialize immediately if DOM is ready
console.log('Document ready state:', document.readyState);

if (document.readyState === 'loading') {
    console.log('DOM still loading, waiting for DOMContentLoaded...');
    document.addEventListener('DOMContentLoaded', initializeLanguageSystem);
} else {
    console.log('DOM already ready, initializing immediately...');
    initializeLanguageSystem();
} 